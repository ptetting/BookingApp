<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Campus Room Booking</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1, h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    .actions button { margin-right: 8px; }
    .logout { float: right; }
    .section { margin-top: 40px; }
    select { padding: 4px; }
    button { padding: 4px 8px; margin-left: 6px; }
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>
  <p class="nav-links">
    <a href="{% url 'home' %}">Return Home</a> |
    <a href="{% url 'logout' %}">Logout</a>
  </p>

  {% if messages %}
    <ul>
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <div class="section">
    <h2>All Rooms</h2>
    <table>
      <tr>
        <th>ID</th>
        <th>Room Number</th>
        <th>Room Type</th>
        <th>Capacity</th>
      </tr>
      {% for room in rooms %}
      <tr>
        <td>{{ room.id }}</td>
        <td>{{ room.room_number }}</td>
        <td>{{ room.room_type.room_type_name }}</td>
        <td>{{ room.capacity }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4">No rooms found.</td></tr>
      {% endfor %}
    </table>
  </div>

  <div class="section">
    <h2>All Bookings</h2>
    <table>
      <tr>
        <th>ID</th>
        <th>Room</th>
        <th>User</th>
        <th>Start</th>
        <th>End</th>
        <th>Status</th>
      </tr>
      {% for booking in bookings %}
      <tr>
        <td>{{ booking.id }}</td>
        <td>{{ booking.room.room_number }}</td>
        <td>{{ booking.user.name }}</td>
        <td>{{ booking.start_time }}</td>
        <td>{{ booking.end_time }}</td>
        <td>
          <form method="post" action="{% url 'update_booking_status' booking.booking_id %}">
            {% csrf_token %}
            <select name="status">
              <option value="pending" {% if booking.status == 'pending' %}selected{% endif %}>Pending</option>
              <option value="approved" {% if booking.status == 'approved' %}selected{% endif %}>Approved</option>
              <option value="cancelled" {% if booking.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
              <option value="completed" {% if booking.status == 'completed' %}selected{% endif %}>Completed</option>
            </select>
            <button type="submit">Update</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6">No bookings found.</td></tr>
      {% endfor %}
    </table>
  </div>
 <!-- ------------------- ROOM AVAILABILITY & FUTURE BOOKINGS ------------------- -->
  <div class="section">
    <h2>Room Availability & Future Bookings</h2>
    {% for item in room_data %}
      <h3>Room {{ item.room.room_number }} ({{ item.room.room_type.room_type_name }})</h3>
      <p>Capacity: {{ item.room.capacity }}</p>

      <h4>Available Slots:</h4>
      {% if item.availabilities %}
        <ul>
          {% for slot in item.availabilities %}
            <li>{{ slot.start_time }} - {{ slot.end_time }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No available slots</p>
      {% endif %}

      <h4>Future Bookings:</h4>
      {% if item.bookings %}
        <ul>
          {% for booking in item.bookings %}
            <li>{{ booking.start_time }} - {{ booking.end_time }} | Status: {{ booking.status|title }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No future bookings</p>
      {% endif %}
      <hr>
    {% endfor %}
  </div>
</body>
</html>